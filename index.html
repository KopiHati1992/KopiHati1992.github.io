<!DOCTYPE html>
<html>
<head><title>KH1992 Billing</title></head>
<body>
  <h2>Tambah Customer</h2>
  <input id="nama" placeholder="Nama">
  <input id="wa" placeholder="WhatsApp">
  <input id="alamat" placeholder="Alamat">
  <input id="tagihan" placeholder="Tagihan">
  <input id="tanggal" type="date">
  <input id="ip" placeholder="IP Internet">
  <input id="keterangan" placeholder="Keterangan">
  <button onclick="simpanCustomer()">Simpan</button>

  <hr>
  <h2>Bayar Tagihan</h2>
  <select id="customerSelect"></select>
  <select id="metode">
    <option>Cash</option><option>TF</option><option>E-wallet</option>
  </select>
  <input id="tanggalBayar" type="date">
  <button onclick="bayar()">Bayar</button>

  <hr>
  <h2>Laporan</h2>
  <select id="bulan" onchange="tampilkanLaporan()">
    <option>Juni</option><option>Juli</option><option>Agustus</option>
  </select>
  <table border="1" id="laporan"><tbody></tbody></table>

<script>
const URL = 'https://script.google.com/macros/s/AKfycbxsRli-J5zSgUFbERBkG86doZemQp969-v7ndPYEbzMFQwvpAl3zLMd96OHCzCOPD0v/exec';

async function simpanCustomer() {
  const data = {
    action: 'tambahCustomer',
    nama: nama.value, wa: wa.value, alamat: alamat.value,
    tagihan: tagihan.value, tanggal: tanggal.value,
    ip: ip.value, ket: keterangan.value
  };
  await fetch(URL, { method: 'POST', body: JSON.stringify(data) });
  alert("Customer disimpan");
  loadCustomer();
}

async function bayar() {
  const data = {
    action: 'simpanPembayaran',
    customer: customerSelect.value,
    metode: metode.value,
    tanggal: tanggalBayar.value
  };
  await fetch(URL, { method: 'POST', body: JSON.stringify(data) });
  alert("Pembayaran disimpan");
  tampilkanLaporan();
}

async function tampilkanLaporan() {
  const res = await fetch(`${URL}?action=getLaporan&bulan=${bulan.value}`);
  const data = await res.json();
  const tbody = document.getElementById('laporan').querySelector('tbody');
  tbody.innerHTML = '';
  data.forEach(r => {
    tbody.innerHTML += `<tr><td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td></tr>`;
  });
}

async function loadCustomer() {
  const res = await fetch(`${URL}?action=getCustomers`);
  const data = await res.json();
  customerSelect.innerHTML = '';
  data.forEach(n => {
    const opt = document.createElement('option');
    opt.value = opt.text = n;
    customerSelect.appendChild(opt);
  });
}

loadCustomer();
tampilkanLaporan();
</script>
</body>
</html>
